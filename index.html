<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BANI VFX â€” Videos</title>
  <meta name="description" content="GalerÃ­a minimalista del canal BANI VFX con YouTube Data API v3." />
  <style>
    :root {
      --bg: #0b0b0c; /* negro BANI */
      --card: #121214;
      --text: #f6f6f6;
      --muted: #a1a1a6;
      --accent: #ff2ca5; /* rosa BANI */
      --border: #202027;
    }
    :root.light {
      --bg: #ffffff; /* blanco */
      --card: #f7f7fb;
      --text: #141417;
      --muted: #6b6b6e;
      --accent: #ff2ca5; /* rosa BANI */
      --border: #e7e7ef;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background: var(--bg); color: var(--text); }
    header { position: sticky; top: 0; z-index: 10; backdrop-filter: saturate(140%) blur(8px); background: color-mix(in oklab, var(--bg) 82%, transparent); border-bottom: 1px solid var(--border); }
    .wrap { max-width: 1400px; margin: 0 auto; padding: 18px 16px; }
    h1 { font-size: 20px; margin: 0; letter-spacing: .2px; font-weight: 800; }
    .controls { display: grid; grid-template-columns: 1fr auto auto; gap: 10px; align-items: center; }
    .search { display: flex; align-items: center; gap: 8px; border: 1px solid var(--border); background: var(--card); border-radius: 999px; padding: 10px 14px; }
    .search input { flex: 1; border: 0; outline: 0; background: transparent; color: var(--text); font-size: 15px; }
    .btn { border: 1px solid var(--border); background: var(--card); color: var(--text); padding: 10px 14px; border-radius: 999px; cursor: pointer; font-size: 14px; }
    .btn:hover { border-color: color-mix(in oklab, var(--accent) 40%, var(--border)); }

    /* --- GRID FULL-WIDTH Y CARDS GRANDES --- */
    .grid { display: grid; grid-template-columns: repeat( auto-fit, minmax(420px, 1fr) ); gap: 18px; padding: 22px 16px 90px; max-width: 100%; margin: 0 auto; }
    @media (min-width: 1600px) { .grid { grid-template-columns: repeat( auto-fit, minmax(520px, 1fr) ); } }

    .card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; overflow: clip; transition: transform .12s ease, box-shadow .12s ease; }
    .card:hover { transform: translateY(-2px); box-shadow: 0 10px 22px rgba(0,0,0,.16); }
    .thumb { aspect-ratio: 16/9; width: 100%; background: #000; display: grid; place-items: center; position: relative; }
    .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .play { position: absolute; inset: auto auto 12px 12px; background: #000a; color: #fff; font-size: 13px; padding: 8px 10px; border-radius: 10px; border: 1px solid #fff3; }
    .meta { padding: 12px 14px 16px; }
    .title { font-size: 16px; line-height: 1.35; margin: 0 0 8px; font-weight: 700; }
    .muted { font-size: 13px; color: var(--muted); }
    .empty { text-align: center; padding: 64px 16px; color: var(--muted); }
    footer { max-width: 1400px; margin: 0 auto 40px; color: var(--muted); font-size: 12px; padding: 0 16px; }

    /* Modal */
    dialog { border: none; padding: 0; border-radius: 16px; overflow: clip; background: var(--card); color: var(--text); box-shadow: 0 12px 40px rgba(0,0,0,.5); width: min(1200px, 96vw); }
    dialog::backdrop { background: rgba(0,0,0,.6); }
    .modal-head { display: flex; align-items: center; justify-content: space-between; padding: 12px 14px; border-bottom: 1px solid var(--border); }
    .modal-body { padding: 0; }
    .close { background: transparent; color: var(--muted); border: 1px solid var(--border); border-radius: 10px; padding: 8px 12px; cursor: pointer; }
    .player { aspect-ratio: 16/9; width: 100%; background: #000; }
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex; gap:16px; align-items:center; justify-content:space-between;">
      <div style="display:flex; align-items:center; gap:12px;">
        <div style="width:28px; height:28px; border-radius:8px; background: linear-gradient(135deg, var(--accent), #8a2be2); border:1px solid var(--border);"></div>
        <h1>BANI VFX â€” Videos</h1>
      </div>
      <div class="controls" style="flex:1; max-width:820px;">
        <div class="search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.6"/></svg>
          <input id="q" placeholder="Buscar por tÃ­tuloâ€¦" autocomplete="off" />
        </div>
        <button class="btn" id="themeBtn" title="Modo claro/oscuro">ðŸŒ“ Tema</button>
        <button class="btn" id="sortBtn" title="Ordenar por fecha/tÃ­tulo">â‡… Orden</button>
      </div>
    </div>
  </header>

  <main>
    <section id="grid" class="grid" aria-live="polite"></section>
    <div id="empty" class="empty">Cargandoâ€¦</div>
  </main>

  <footer>
    <p>Hecho con cariÃ±o por BANI VFX. âœ¨</p>
  </footer>

  <dialog id="modal">
    <div class="modal-head">
      <div id="modalTitle" style="font-weight:700;">Reproduciendoâ€¦</div>
      <button class="close" id="closeModal">Cerrar</button>
    </div>
    <div class="modal-body">
      <iframe id="player" class="player" src="" title="YouTube player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    </div>
  </dialog>

  <script>
    /* ===== Config BANI (auto API) ===== */
    const API_KEY = "AIzaSyAvH1ulPBHpFC2_2IHLR_x438yRBdMvdNk"; // provista por el usuario
    const CHANNEL_ID = "UCLO5xC1DJcQFOL1kvUQzXLg"; // @BANIVFX

    const $ = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

    const state = {
      items: [], // {id, title, publishedAt}
      order: 'date-desc',
      theme: localStorage.getItem('ytgrid-theme') || (matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark')
    };

    function applyTheme() {
      document.documentElement.classList.toggle('light', state.theme === 'light');
      localStorage.setItem('ytgrid-theme', state.theme);
    }

    function render() {
      const q = $('#q').value.trim().toLowerCase();
      let rows = state.items;
      if (q) rows = rows.filter(v => (v.title || '').toLowerCase().includes(q));

      if (state.order === 'date-desc') rows = rows.slice().sort((a,b)=> new Date(b.publishedAt||0) - new Date(a.publishedAt||0));
      if (state.order === 'date-asc') rows = rows.slice().sort((a,b)=> new Date(a.publishedAt||0) - new Date(b.publishedAt||0));
      if (state.order === 'title-asc') rows = rows.slice().sort((a,b)=> (a.title||'').localeCompare(b.title||''));

      const grid = $('#grid');
      grid.innerHTML = '';
      rows.forEach(v => grid.appendChild(card(v)));

      $('#empty').hidden = rows.length !== 0;
      if (!rows.length) $('#empty').textContent = 'Sin resultados';
    }

    function card(v) {
      const el = document.createElement('article');
      el.className = 'card';
      const date = v.publishedAt ? new Date(v.publishedAt).toLocaleDateString(undefined, { year:'numeric', month:'short', day:'2-digit' }) : '';
      el.innerHTML = `
        <div class="thumb" role="button" aria-label="Reproducir ${escapeHtml(v.title||'Video')}" data-id="${v.id}" data-title="${escapeHtml(v.title||'Video')}">
          <img loading="lazy" src="https://i.ytimg.com/vi/${v.id}/hqdefault.jpg" alt="Miniatura de ${escapeHtml(v.title||'')}">
          <span class="play">â–¶ Reproducir</span>
        </div>
        <div class="meta">
          <h3 class="title">${escapeHtml(v.title||'â€”')}</h3>
          <div class="muted">${date}</div>
        </div>`;
      el.querySelector('.thumb').addEventListener('click', () => openModal(v.id, v.title));
      return el;
    }

    function escapeHtml(s='') { return s.replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }

    function openModal(id, title='') {
      $('#modalTitle').textContent = title || 'Reproduciendoâ€¦';
      $('#player').src = `https://www.youtube.com/embed/${id}?autoplay=1`;
      $('#modal').showModal();
    }
    $('#closeModal').addEventListener('click', () => { $('#player').src = ''; $('#modal').close(); });

    // Controles
    $('#themeBtn').addEventListener('click', () => { state.theme = (state.theme === 'light' ? 'dark' : 'light'); applyTheme(); });
    $('#sortBtn').addEventListener('click', () => { state.order = state.order === 'date-desc' ? 'title-asc' : (state.order === 'title-asc' ? 'date-asc' : 'date-desc'); render(); });
    $('#q').addEventListener('input', render);

    // API fetch
    async function fetchChannelUploads(key, channelId) {
      const ch = await ytJson(`https://www.googleapis.com/youtube/v3/channels?part=contentDetails&id=${channelId}&key=${key}`);
      const uploads = ch.items?.[0]?.contentDetails?.relatedPlaylists?.uploads;
      if (!uploads) throw new Error('No se encontrÃ³ uploads playlist.');
      return fetchPlaylistItems(key, uploads);
    }

    async function fetchPlaylistItems(key, playlistId) {
      let pageToken = '';
      const out = [];
      do {
        const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${key}${pageToken?`&pageToken=${pageToken}`:''}`;
        const json = await ytJson(url);
        json.items?.forEach(it => {
          const s = it.snippet || {};
          out.push({ id: s.resourceId?.videoId, title: s.title, publishedAt: s.publishedAt });
        });
        pageToken = json.nextPageToken || '';
      } while (pageToken);
      return out.filter(v => !!v.id);
    }

    async function ytJson(url) { const r = await fetch(url); if (!r.ok) throw new Error('HTTP ' + r.status); return r.json(); }

    async function loadFromAPI() {
      try {
        const items = await fetchChannelUploads(API_KEY, CHANNEL_ID);
        state.items = items;
        $('#empty').hidden = true;
        render();
      } catch (e) {
        console.error(e);
        $('#empty').textContent = 'Error al cargar videos. RevisÃ¡ la API Key o la cuota.';
      }
    }

    (function init() { applyTheme(); loadFromAPI(); })();
  </script>
</body>
</html>
